<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started with Modeltime H2O • modeltime.h2o</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with Modeltime H2O">
<meta property="og:description" content="modeltime.h2o">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-76139189-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76139189-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">modeltime.h2o</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/getting-started.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Documentation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Forecasting</li>
    <li>
      <a href="../articles/getting-started.html">Getting Started with Modeltime</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/business-science/modeltime">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="getting-started_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started with Modeltime H2O</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/business-science/modeltime.h2o/blob/master/vignettes/getting-started.Rmd"><code>vignettes/getting-started.Rmd</code></a></small>
      <div class="hidden name"><code>getting-started.Rmd</code></div>

    </div>

    
    
<p><img src="logo.png" width="147" height="170" align="right"></p>
<p>Forecasting with <code>modeltime.h2o</code> made easy! This short tutorial shows how you can use:</p>
<ul>
<li><p><strong>H2O AutoML</strong> for forecasting implemented via <code><a href="../reference/automl_reg.html">automl_reg()</a></code>. This function trains and cross-validates multiple machine learning and deep learning models (XGBoost GBM, GLMs, Random Forest, GBMs…) and then trains two Stacked Ensembled models, one of all the models, and one of only the best models of each kind. Finally, the best model is selected based on a stopping metric. And we take care of all this for you!</p></li>
<li><p><strong>Save &amp; Load Models</strong> functionality to ensure the persistence of your models.</p></li>
</ul>
<div id="libraries" class="section level2">
<h2 class="hasAnchor">
<a href="#libraries" class="anchor"></a>Libraries</h2>
<p>Load the following libraries:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/modeltime.h2o">modeltime.h2o</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/timetk">timetk</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="collect-data-and-split-into-training-and-test-sets" class="section level2">
<h2 class="hasAnchor">
<a href="#collect-data-and-split-into-training-and-test-sets" class="anchor"></a>Collect data and split into training and test sets</h2>
<p>Next, we load the <code>walmart_sales_weekly</code> data containing 7 time series and visualize them using the <code><a href="https://rdrr.io/pkg/timetk/man/plot_time_series.html">timetk::plot_time_series()</a></code> function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_tbl</span> <span class="op">&lt;-</span> <span class="va">walmart_sales_weekly</span> <span class="op">%&gt;%</span>
    <span class="fu">select</span><span class="op">(</span><span class="va">id</span>, <span class="va">Date</span>, <span class="va">Weekly_Sales</span><span class="op">)</span>

<span class="va">data_tbl</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/timetk/man/plot_time_series.html">plot_time_series</a></span><span class="op">(</span>
      .date_var    <span class="op">=</span> <span class="va">Date</span>,
      .value       <span class="op">=</span> <span class="va">Weekly_Sales</span>,
      .facet_ncol  <span class="op">=</span> <span class="fl">2</span>,
      .smooth      <span class="op">=</span> <span class="cn">F</span>,
      .interactive <span class="op">=</span> <span class="cn">F</span>
  <span class="op">)</span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>Then, we separate the data with the <code><a href="https://rdrr.io/pkg/timetk/man/time_series_split.html">time_series_split()</a></code> function and generate a training dataset and a test one.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">splits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timetk/man/time_series_split.html">time_series_split</a></span><span class="op">(</span><span class="va">data_tbl</span>, assess <span class="op">=</span> <span class="st">"3 month"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">recipe_spec</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">Weekly_Sales</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="fu">training</span><span class="op">(</span><span class="va">splits</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/timetk/man/step_timeseries_signature.html">step_timeseries_signature</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span> 

<span class="va">train_tbl</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">splits</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">bake</span><span class="op">(</span><span class="fu">prep</span><span class="op">(</span><span class="va">recipe_spec</span><span class="op">)</span>, <span class="va">.</span><span class="op">)</span>
<span class="va">test_tbl</span>  <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">splits</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">bake</span><span class="op">(</span><span class="fu">prep</span><span class="op">(</span><span class="va">recipe_spec</span><span class="op">)</span>, <span class="va">.</span><span class="op">)</span></code></pre></div>
</div>
<div id="model-specification-training-and-prediction" class="section level2">
<h2 class="hasAnchor">
<a href="#model-specification-training-and-prediction" class="anchor"></a>Model specification, training and prediction</h2>
<p>In order to correctly use modeltime.h2o, it is necessary to connect to an H2O cluster through the <code><a href="https://rdrr.io/pkg/h2o/man/h2o.init.html">h2o.init()</a></code> function. You can find more information on how to set up the cluster by typing <code><a href="https://rdrr.io/pkg/h2o/man/h2o.init.html">?h2o.init</a></code> or by visiting the <a href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/starting-h2o.html">official site</a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Initialize H2O</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.init.html">h2o.init</a></span><span class="op">(</span>
    nthreads <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,
    ip       <span class="op">=</span> <span class="st">'localhost'</span>,
    port     <span class="op">=</span> <span class="fl">54321</span>
<span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; H2O is not running yet, starting it now...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Note:  In case of errors look at the following log files:</span>
<span class="co">#&gt;     /tmp/RtmpENfKR2/file3dbb47e511e9/h2o_runner_started_from_r.out</span>
<span class="co">#&gt;     /tmp/RtmpENfKR2/file3dbb178808a6/h2o_runner_started_from_r.err</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Starting H2O JVM and connecting: ... Connection successful!</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; R is connected to the H2O cluster: </span>
<span class="co">#&gt;     H2O cluster uptime:         2 seconds 590 milliseconds </span>
<span class="co">#&gt;     H2O cluster timezone:       UTC </span>
<span class="co">#&gt;     H2O data parsing timezone:  UTC </span>
<span class="co">#&gt;     H2O cluster version:        3.32.0.1 </span>
<span class="co">#&gt;     H2O cluster version age:    5 months and 11 days !!! </span>
<span class="co">#&gt;     H2O cluster name:           H2O_started_from_R_runner_amc448 </span>
<span class="co">#&gt;     H2O cluster total nodes:    1 </span>
<span class="co">#&gt;     H2O cluster total memory:   1.51 GB </span>
<span class="co">#&gt;     H2O cluster total cores:    2 </span>
<span class="co">#&gt;     H2O cluster allowed cores:  2 </span>
<span class="co">#&gt;     H2O cluster healthy:        TRUE </span>
<span class="co">#&gt;     H2O Connection ip:          localhost </span>
<span class="co">#&gt;     H2O Connection port:        54321 </span>
<span class="co">#&gt;     H2O Connection proxy:       NA </span>
<span class="co">#&gt;     H2O Internal Security:      FALSE </span>
<span class="co">#&gt;     H2O API Extensions:         Amazon S3, XGBoost, Algos, AutoML, Core V3, TargetEncoder, Core V4 </span>
<span class="co">#&gt;     R Version:                  R version 4.0.4 (2021-02-15)</span>

<span class="co"># Optional - Set H2O No Progress to remove progress bars</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.no_progress.html">h2o.no_progress</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Now comes the fun part! We define our model specification with the <code><a href="../reference/automl_reg.html">automl_reg()</a></code> function and pass the arguments through the engine:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/automl_reg.html">automl_reg</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">'regression'</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">set_engine</span><span class="op">(</span>
         engine                     <span class="op">=</span> <span class="st">'h2o'</span>,
         max_runtime_secs           <span class="op">=</span> <span class="fl">5</span>, 
         max_runtime_secs_per_model <span class="op">=</span> <span class="fl">3</span>,
         max_models                 <span class="op">=</span> <span class="fl">3</span>,
         nfolds                     <span class="op">=</span> <span class="fl">5</span>,
         exclude_algos              <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DeepLearning"</span><span class="op">)</span>,
         verbosity                  <span class="op">=</span> <span class="cn">NULL</span>,
         seed                       <span class="op">=</span> <span class="fl">786</span>
    <span class="op">)</span> 

<span class="va">model_spec</span>
<span class="co">#&gt; H2O AutoML Model Specification (regression)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Engine-Specific Arguments:</span>
<span class="co">#&gt;   max_runtime_secs = 5</span>
<span class="co">#&gt;   max_runtime_secs_per_model = 3</span>
<span class="co">#&gt;   max_models = 3</span>
<span class="co">#&gt;   nfolds = 5</span>
<span class="co">#&gt;   exclude_algos = c("DeepLearning")</span>
<span class="co">#&gt;   verbosity = NULL</span>
<span class="co">#&gt;   seed = 786</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computational engine: h2o</span></code></pre></div>
<p>Next, let’s train the model with <code>fit()</code>!</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_fitted</span> <span class="op">&lt;-</span> <span class="va">model_spec</span> <span class="op">%&gt;%</span>
    <span class="fu">fit</span><span class="op">(</span><span class="va">Weekly_Sales</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_tbl</span><span class="op">)</span>
<span class="co">#&gt;                                           model_id mean_residual_deviance</span>
<span class="co">#&gt; 1 StackedEnsemble_AllModels_AutoML_20210320_005340              155888140</span>
<span class="co">#&gt; 2                 XGBoost_3_AutoML_20210320_005340              293895739</span>
<span class="co">#&gt; 3                 XGBoost_2_AutoML_20210320_005340             1155709343</span>
<span class="co">#&gt; 4                 XGBoost_1_AutoML_20210320_005340             1209298728</span>
<span class="co">#&gt;       rmse        mse       mae     rmsle</span>
<span class="co">#&gt; 1 12485.52  155888140  9038.713 0.2389231</span>
<span class="co">#&gt; 2 17143.39  293895739 11352.049 0.3072503</span>
<span class="co">#&gt; 3 33995.73 1155709343 23989.388 0.8423622</span>
<span class="co">#&gt; 4 34774.97 1209298728 25043.280 0.8497787</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [4 rows x 6 columns]</span>

<span class="va">model_fitted</span>
<span class="co">#&gt; parsnip model object</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fit time:  13s </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; H2O AutoML - Stackedensemble</span>
<span class="co">#&gt; --------</span>
<span class="co">#&gt; Model: Model Details:</span>
<span class="co">#&gt; ==============</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; H2ORegressionModel: stackedensemble</span>
<span class="co">#&gt; Model ID:  StackedEnsemble_AllModels_AutoML_20210320_005340 </span>
<span class="co">#&gt; Number of Base Models: 3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Base Models (count by algorithm type):</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; xgboost </span>
<span class="co">#&gt;       3 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Metalearner:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Metalearner algorithm: glm</span>
<span class="co">#&gt; Metalearner cross-validation fold assignment:</span>
<span class="co">#&gt;   Fold assignment scheme: AUTO</span>
<span class="co">#&gt;   Number of folds: 5</span>
<span class="co">#&gt;   Fold column: NULL</span>
<span class="co">#&gt; Metalearner hyperparameters: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; H2ORegressionMetrics: stackedensemble</span>
<span class="co">#&gt; ** Reported on training data. **</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  64101063</span>
<span class="co">#&gt; RMSE:  8006.314</span>
<span class="co">#&gt; MAE:  6429.391</span>
<span class="co">#&gt; RMSLE:  0.2512483</span>
<span class="co">#&gt; Mean Residual Deviance :  64101063</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; H2ORegressionMetrics: stackedensemble</span>
<span class="co">#&gt; ** Reported on cross-validation data. **</span>
<span class="co">#&gt; ** 5-fold cross-validation on training data (Metrics computed for combined holdout predictions) **</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  155888140</span>
<span class="co">#&gt; RMSE:  12485.52</span>
<span class="co">#&gt; MAE:  9038.713</span>
<span class="co">#&gt; RMSLE:  0.2389231</span>
<span class="co">#&gt; Mean Residual Deviance :  155888140</span></code></pre></div>
<p>The best models are stored in the <code>leaderbord</code> and by default the one with the best metric with which you have decided to sort the leaderbord is selected (this behavior can be controlled with the <code>sort_metric</code> parameter passed through set_engine. For more information see ?h2o.automl. By default, it is sorted by the mean_residual_deviance). To list the models created during training that have finally been stored in the leaderbord you can use the <code>automl_leaderbord</code> function as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/automl_leaderboard.html">automl_leaderboard</a></span><span class="op">(</span><span class="va">model_fitted</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4 x 6</span>
<span class="co">#&gt;   model_id                      mean_residual_devi…   rmse      mse    mae rmsle</span>
<span class="co">#&gt;   &lt;chr&gt;                                       &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 StackedEnsemble_AllModels_Au…          155888140. 12486.   1.56e8  9039. 0.239</span>
<span class="co">#&gt; 2 XGBoost_3_AutoML_20210320_00…          293895739. 17143.   2.94e8 11352. 0.307</span>
<span class="co">#&gt; 3 XGBoost_2_AutoML_20210320_00…         1155709343. 33996.   1.16e9 23989. 0.842</span>
<span class="co">#&gt; 4 XGBoost_1_AutoML_20210320_00…         1209298728. 34775.   1.21e9 25043. 0.850</span></code></pre></div>
<p>To change the default selected model (remember, the first one sorted according to the selected metric) you can do it with the <code><a href="../reference/automl_leaderboard.html">automl_update_model()</a></code> function as follows (do not run the following example as the model id name will have changed as there is randomness in the process):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/automl_leaderboard.html">automl_update_model</a></span><span class="op">(</span><span class="va">model_fitted</span>, model_id <span class="op">=</span> <span class="st">"StackedEnsemble_AllModels_AutoML_20210319_204825"</span><span class="op">)</span></code></pre></div>
<p>Finally, we <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> on the test dataset:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_fitted</span>, <span class="va">test_tbl</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 84 x 1</span>
<span class="co">#&gt;      .pred</span>
<span class="co">#&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1  30189.</span>
<span class="co">#&gt;  2  33062.</span>
<span class="co">#&gt;  3  37945.</span>
<span class="co">#&gt;  4  47269.</span>
<span class="co">#&gt;  5  79901.</span>
<span class="co">#&gt;  6  74320.</span>
<span class="co">#&gt;  7 119437.</span>
<span class="co">#&gt;  8  30189.</span>
<span class="co">#&gt;  9  39868.</span>
<span class="co">#&gt; 10  37945.</span>
<span class="co">#&gt; # … with 74 more rows</span></code></pre></div>
</div>
<div id="modeltime-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#modeltime-workflow" class="anchor"></a>Modeltime Workflow</h2>
<p>Once we have our fitted model, we can follow the <a href="https://business-science.github.io/modeltime/articles/getting-started-with-modeltime.html">Modeltime Workflow</a>:</p>
<ul>
<li><p>Add fitted models to a <strong>Model Table</strong>.</p></li>
<li><p><strong>Calibrate</strong> the models to a testing set.</p></li>
<li><p>Perform Testing Set <strong>Forecast Evaluation</strong> &amp; Accuracy Evaluation.</p></li>
<li><p><strong>Refit</strong> the models to Full Dataset &amp; Forecast Forward</p></li>
</ul>
</div>
<div id="add-fitted-models-to-a-model-table" class="section level2">
<h2 class="hasAnchor">
<a href="#add-fitted-models-to-a-model-table" class="anchor"></a>Add fitted models to a Model Table</h2>
<p>First, we create the model table:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modeltime_tbl</span> <span class="op">&lt;-</span> <span class="fu">modeltime_table</span><span class="op">(</span>
    <span class="va">model_fitted</span>
<span class="op">)</span> 

<span class="va">modeltime_tbl</span>
<span class="co">#&gt; # Modeltime Table</span>
<span class="co">#&gt; # A tibble: 1 x 3</span>
<span class="co">#&gt;   .model_id .model   .model_desc                 </span>
<span class="co">#&gt;       &lt;int&gt; &lt;list&gt;   &lt;chr&gt;                       </span>
<span class="co">#&gt; 1         1 &lt;fit[+]&gt; H2O AUTOML - STACKEDENSEMBLE</span></code></pre></div>
</div>
<div id="calibrate-testing-set-forecast-accuracy-evaluation" class="section level2">
<h2 class="hasAnchor">
<a href="#calibrate-testing-set-forecast-accuracy-evaluation" class="anchor"></a>Calibrate &amp; Testing Set Forecast &amp; Accuracy Evaluation</h2>
<p>Next, we calibrate to the testing set and visualize the forecasts:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modeltime_tbl</span> <span class="op">%&gt;%</span>
  <span class="fu">modeltime_calibrate</span><span class="op">(</span><span class="va">test_tbl</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">modeltime_forecast</span><span class="op">(</span>
        new_data    <span class="op">=</span> <span class="va">test_tbl</span>,
        actual_data <span class="op">=</span> <span class="va">data_tbl</span>,
        keep_data   <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">plot_modeltime_forecast</span><span class="op">(</span>
        .facet_ncol <span class="op">=</span> <span class="fl">2</span>, 
        .interactive <span class="op">=</span> <span class="cn">FALSE</span>
    <span class="op">)</span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-12-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div id="refit-to-full-dataset-forecast-forward" class="section level2">
<h2 class="hasAnchor">
<a href="#refit-to-full-dataset-forecast-forward" class="anchor"></a>Refit to Full Dataset &amp; Forecast Forward</h2>
<p>Before using <strong>refit</strong> on our dataset, let’s prepare our data. We create <code>data_prepared_tbl</code> which represents the complete dataset (the union of train and test) with the variables created with the recipe named recipe_spec. Subsequently, we create the dataset <code>future_prepared_tbl</code> that represents the dataset with the future data to one year and the required variables.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_prepared_tbl</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">train_tbl</span>, <span class="va">test_tbl</span><span class="op">)</span>

<span class="va">future_tbl</span> <span class="op">&lt;-</span> <span class="va">data_prepared_tbl</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/timetk/man/future_frame.html">future_frame</a></span><span class="op">(</span>.length_out <span class="op">=</span> <span class="st">"1 year"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span>

<span class="va">future_prepared_tbl</span> <span class="op">&lt;-</span> <span class="fu">bake</span><span class="op">(</span><span class="fu">prep</span><span class="op">(</span><span class="va">recipe_spec</span><span class="op">)</span>, <span class="va">future_tbl</span><span class="op">)</span></code></pre></div>
<p>Finally, we use forecast in our future dataset and visualize the results once we had reffited.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">refit_tbl</span> <span class="op">&lt;-</span> <span class="va">modeltime_tbl</span> <span class="op">%&gt;%</span>
    <span class="fu">modeltime_refit</span><span class="op">(</span><span class="va">data_prepared_tbl</span><span class="op">)</span>
<span class="co">#&gt;                                           model_id mean_residual_deviance</span>
<span class="co">#&gt; 1 StackedEnsemble_AllModels_AutoML_20210320_005359              680575277</span>
<span class="co">#&gt; 2                 XGBoost_3_AutoML_20210320_005359             1587790642</span>
<span class="co">#&gt; 3                 XGBoost_2_AutoML_20210320_005359             1802082476</span>
<span class="co">#&gt; 4                 XGBoost_1_AutoML_20210320_005359             1827422974</span>
<span class="co">#&gt;       rmse        mse      mae     rmsle</span>
<span class="co">#&gt; 1 26087.84  680575277 21666.80 0.5830631</span>
<span class="co">#&gt; 2 39847.09 1587790642 30079.63 0.9887960</span>
<span class="co">#&gt; 3 42450.94 1802082476 32777.80 1.0998055</span>
<span class="co">#&gt; 4 42748.37 1827422974 32106.88 1.1000969</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [4 rows x 6 columns]</span>

<span class="va">refit_tbl</span> <span class="op">%&gt;%</span>
    <span class="fu">modeltime_forecast</span><span class="op">(</span>
        new_data    <span class="op">=</span> <span class="va">future_prepared_tbl</span>,
        actual_data <span class="op">=</span> <span class="va">data_prepared_tbl</span>,
        keep_data   <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">plot_modeltime_forecast</span><span class="op">(</span>
        .facet_ncol  <span class="op">=</span> <span class="fl">2</span>,
        .interactive <span class="op">=</span> <span class="cn">FALSE</span>
    <span class="op">)</span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-14-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>We can likely do better than this if we train longer but really good for a quick example!</p>
</div>
<div id="saving-and-loading-models" class="section level2">
<h2 class="hasAnchor">
<a href="#saving-and-loading-models" class="anchor"></a>Saving and Loading Models</h2>
<p>H2O models will need to “serialized” (a fancy word for saved to a directory that contains the recipe for recreating the models). To save the models, use <code><a href="../reference/save_h2o_model.html">save_h2o_model()</a></code>.</p>
<ul>
<li>Provide a directory where you want to save the model.</li>
<li>This saves the model file in the directory.</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_fitted</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/save_h2o_model.html">save_h2o_model</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../model_fitted"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>You can reload the model into R using <code><a href="../reference/save_h2o_model.html">load_h2o_model()</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_h2o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/save_h2o_model.html">load_h2o_model</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../model_fitted/"</span><span class="op">)</span></code></pre></div>
</div>
<div id="take-the-high-performance-forecasting-course" class="section level2">
<h2 class="hasAnchor">
<a href="#take-the-high-performance-forecasting-course" class="anchor"></a>Take the High-Performance Forecasting Course</h2>
<blockquote>
<p>Become the forecasting expert for your organization</p>
</blockquote>
<p><a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/" target="_blank"><img src="https://www.filepicker.io/api/file/bKyqVAi5Qi64sS05QYLk" alt="High-Performance Time Series Forecasting Course" width="100%" style="box-shadow: 0 0 5px 2px rgba(0, 0, 0, .5);"></a></p>
<p><a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/"><em>High-Performance Time Series Course</em></a></p>
<div id="time-series-is-changing" class="section level3">
<h3 class="hasAnchor">
<a href="#time-series-is-changing" class="anchor"></a>Time Series is Changing</h3>
<p>Time series is changing. <strong>Businesses now need 10,000+ time series forecasts every day.</strong> This is what I call a <em>High-Performance Time Series Forecasting System (HPTSF)</em> - Accurate, Robust, and Scalable Forecasting.</p>
<p><strong>High-Performance Forecasting Systems will save companies by improving accuracy and scalability.</strong> Imagine what will happen to your career if you can provide your organization a “High-Performance Time Series Forecasting System” (HPTSF System).</p>
</div>
<div id="how-to-learn-high-performance-time-series-forecasting" class="section level3">
<h3 class="hasAnchor">
<a href="#how-to-learn-high-performance-time-series-forecasting" class="anchor"></a>How to Learn High-Performance Time Series Forecasting</h3>
<p>I teach how to build a HPTFS System in my <a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting"><strong>High-Performance Time Series Forecasting Course</strong></a>. You will learn:</p>
<ul>
<li>
<strong>Time Series Machine Learning</strong> (cutting-edge) with <code>Modeltime</code> - 30+ Models (Prophet, ARIMA, XGBoost, Random Forest, &amp; many more)</li>
<li>
<strong>Deep Learning</strong> with <code>GluonTS</code> (Competition Winners)</li>
<li>
<strong>Time Series Preprocessing</strong>, Noise Reduction, &amp; Anomaly Detection</li>
<li>
<strong>Feature engineering</strong> using lagged variables &amp; external regressors</li>
<li><strong>Hyperparameter Tuning</strong></li>
<li><strong>Time series cross-validation</strong></li>
<li>
<strong>Ensembling</strong> Multiple Machine Learning &amp; Univariate Modeling Techniques (Competition Winner)</li>
<li>
<strong>Scalable Forecasting</strong> - Forecast 1000+ time series in parallel</li>
<li>and more.</li>
</ul>
<p class="text-center" style="font-size:24px;">
Become the Time Series Expert for your organization.
</p>
<br><p class="text-center" style="font-size:30px;">
<a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting">Take the High-Performance Time Series Forecasting Course</a>
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matt Dancho.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
